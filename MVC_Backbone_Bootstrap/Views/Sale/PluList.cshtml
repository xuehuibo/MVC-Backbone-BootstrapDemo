<script type="text/template" id="tempPluList">
    @*商品列表模板*@
        <%for(var i=10*(curPage-1);i<10*(curPage-1)+10 && i<pluList.length;i++){%>
            <div class="list-group-item media">
        <div class="list-group-item-body row">
            <img class="media-object col-xs-3" src="../Content/images/<%=pluList[i].PluImage%>.jpg">
            <div class="col-xs-8 col-xs-offset-1">
                <h4 class="media-heading"><%=pluList[i].PluCode+' - '+pluList[i].PluName+'&nbsp;&nbsp;条码:'+pluList[i].BarCode%></h4>
                 <% if(pluList[i].Price!=0) {%>
                <div class="row">
                    <div class="col-xs-6">
                        <h4>原价：<span class="label label-default">￥<%=pluList[i].Price%></span></h4>
                        <h4>现价：<span class="label label-primary">￥<%=pluList[i].FsPrice==undefined?pluList[i].Price:pluList[i].FsPrice%></span></h4>
                        <h4>折扣：<span class="label label-warning"><%=pluList[i].Dsc==undefined?100:pluList[i].FsPrice%>%</span></h4>
                    </div>
                    <div class="col-xs-6">
                        <h4>单位：<%=pluList[i].Unit%></h4>
                        <h4>规格：<%=pluList[i].Spec%></h4>
                    </div>             
                </div>
                <div class="row col-xs-4 pull-right">
                    <div class="input-group">
                        <input type="number" class="form-control" value="1"/>
                        <span class="input-group-btn">
                            <a class="btn btn-primary" href="#sale/<%=i%>">购买</a>
                        </span>
                    </div>  
                </div>
                <%}else {%>
                 <div class="row">
                    <div class="col-xs-6">
                        <div class="input-group">
                            <span class="input-group-addon">原价</span>
                            <input type="text" class="form-control"/>
                        </div>

                        <div class="input-group">
                            <span class="input-group-addon">现价</span>
                            <input type="text" class="form-control"/>
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">折扣</span>
                            <input type="text" class="form-control"/>
                        </div>
                    </div>

                    <div class="col-xs-6">
                        <h4>单位：<%=pluList[i].Unit%></h4>
                        <h4>规格：<%=pluList[i].Spec%></h4>
                    </div>             
                </div>

                 <div class="row">
                     <div class="col-xs-8">
                        <div class="input-group">
                            <span class="input-group-addon">备注</span>
                            <input type="text" class="form-control"/>
                        </div>
                     </div>
                     <div class="col-xs-4  pull-right">
                         <div class="input-group">
                            <input type="number" class="form-control" value="1"/>
                            <span class="input-group-btn">
                                <a class="btn btn-primary" href="#sale/<%=i%>">购买</a>
                            </span>
                        </div>  
                     </div>
                    
                </div>
                <%}%>
                <div class="row">
                    <p><b><%=pluList[i].Brief%></b></p>
                </div>
            </div>
        </div>
    </div>
        <% }%>
        <center>
             <ul class="pagination">
                 <%if(curPage==1){%>
                <li class="disabled"><a>&laquo;</a></li>
                 <%}else {%>
                 <li><a href="#goToPage/<%=parseInt(curPage)-1%>">&laquo;</a></li>
                 <%}%>
                 <% var firstPage=curPage-4 ;%>
                 <% if(firstPage>maxPage-9){%>
                 <%     firstPage=maxPage-9; %>
                 <%}%>
                 <% if(firstPage<=0){ %>
                 <%     firstPage=1;%>
                 <% }%>
                 <% for(var i=firstPage;i<=curPage+5 && i<=maxPage;i++){ %>
                    <% if(i==curPage){%>
                   <li class="active"><a><%=i%></a></li>
                    <% }else {%>
                   <li><a href="#goToPage/<%=i%>"><%=i%></a></li>
                    <% }%>
                 <%}%>
                 <%if(10*curPage>pluList.length){%>
                <li class="disabled"><a>&raquo;</a></li>
                 <%} else {%>
                  <li><a href="#goToPage/<%=parseInt(curPage)+1%>">&raquo;</a></li>
                 <%}%>
            </ul>
        </center>
</script>

<script type="text/javascript">
    //#region 声明命名空间
    if (window.Plu == undefined) {
        Tools.Namespace.register("window.Plu");
    }
    //#endregion

    //#region 声明PluModel
    if (window.Plu.PluModel == undefined) {
        window.Plu.PluModel = Backbone.Model.extend({
            defaults: {
                "OrgCode": "",
                "DepId": 0,
                "DepCode": "",
                "ShpId": 0,
                "ShpCode": "",
                "PluId": 0,
                "PluCode": "",
                "PluName": "",
                "ExPluCode": "",
                "BarCode": "",
                "Unit": "",
                "Spec": "",
                "Price": 0,
                "HyPrice": 0
            }
        });
    }
    //#endregion

    //#region   声明PluList
    if (window.Plu.PluList == undefined) {
        window.Plu.PluList = Backbone.Collection.extend({
            url: "../api/PluApi",
            model: window.Plu.PluModel
        });
    }
    //#endregion

    //#region 声明PluView
    if (window.Plu.PluView == undefined) {
        window.Plu.PluView = Backbone.View.extend({
            tagName: "div",
            className: "panel panel-info col-xs-9",
            maxPage: 1,
            curPage: 1,
            template: _.template($("#tempPluList").html()),
            render: function () {
                this.$el.html(this.template({ pluList: pluList.toJSON(pluList), maxPage: this.maxPage, curPage: this.curPage }));
                location.hash = "show";
            },
            events: {
                "click #btnFilter": "doPluFilter"
            },
            loadPlu: function () {
                pluList.fetch({
                    data: {
                        filterType: filterView.filterType,
                        filterValue: filterView.filterValue
                    },
                    success: function (collection, response, options) {
                        //获取商品成功
                        pluView.maxPage = response.length / 10 + 1;
                        pluView.curPage = 1;
                        pluView.render();
                    },
                    error: function (collection, response, options) {
                        //获取商品失败
                        alert("获取商品信息失败！");
                    }
                });
            },
            goToPage: function (page) {
                pluView.curPage = page;
                pluView.render();
            },
        });
    }
    //#endregion

    //#region   声明FilterView
    if (window.Plu.FilterView == undefined) {
        window.Plu.FilterView = Backbone.View.extend({
            filterValue: "",
            filterType: 0,
            events: {
                "click label": "clickType"
            },
            clickType: function (e) {
                var type = $(e.currentTarget).children("input").val();
                if (type == 0) {
                    $("#filterValue").val("");
                }
                this.filterType = type;
                this.filterValue = $("#filterValue").val();
                //router.navigate("getPluList", { trigger: true });
                pluView.loadPlu();
            }
        });
    }
//#endregion
</script>

<script type="text/javascript">
    var pluView;
    var pluList; //商品列表
    var filterView;//过滤器
    $(function () {
        pluView = new window.Plu.PluView({
            el: "#pluListView"
        });
        filterView = new window.Plu.FilterView({
            el: "#pluFilter"
        })
        pluList = new window.Plu.PluList(); //商品列表
        pluView.loadPlu();
    });
</script>

<div class="navbar" id="pluFilter">
    <div class="navbar-form navbar-left">
        <div class="form-group col-xs-4">
            <input id="filterValue" type="text" class="form-control" placeholder="条码、编码或品名"/>
        </div>
        <div class="btn-group col-xs-4" data-toggle="buttons">
            <label class="btn btn-default active">
                <input type="radio" value="0"/>全部商品
            </label>
            <label class="btn btn-default">
                <input type="radio" value="1"/>过滤商品
            </label>
        </div>
        <div class="input-group col-xs-4 pull-right">
            <span class="input-group-addon">当前第1页</span>
            <input type="text" class="form-control" placeholder="页码">
             <span class="input-group-btn">
                <a class="btn btn-default" type="button">跳转</a>
              </span>
        </div>

    </div>   
</div>

<div id="pluListView" class="media-list" >

</div>